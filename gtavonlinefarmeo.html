<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GTA Online DPM Tracker (Base de Datos Editable)</title>
    <style>
        :root {
            --bg-color: #0d1117;
            --text-main: #f0f6fc;
            --gold-mansion: #d4af37;
            --green-active: #238636;
            --red-cooldown: #f85149;
            --dpm-color: #00ffc4;
            --header-bg: #1f2731;
            --row-bg: #161b22;
            --data-box-bg: #1e3a47;
            --font-main: 'Segoe UI', Roboto, sans-serif;
        }

        body {
            font-family: var(--font-main);
            background-color: var(--bg-color);
            color: var(--text-main);
            margin: 0;
            padding: 20px;
        }

        header {
            text-align: center;
            border-bottom: 3px solid var(--gold-mansion);
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        h1 {
            color: var(--gold-mansion);
            margin: 0;
        }

        .grid-container {
            display: grid;
            grid-template-columns: 18% 8% 6% 6% 6% 6% 6% 6% 6% 6% 6% 10%;
            gap: 1px;
            background-color: #30363d;
            border-radius: 8px;
            overflow: hidden;
        }

        .grid-header {
            background-color: var(--header-bg);
            color: var(--text-main);
            font-weight: bold;
            padding: 10px 5px;
            text-align: center;
            font-size: 0.85rem;
            text-transform: uppercase;
        }

        .grid-row {
            display: contents;
        }

        .grid-cell {
            background-color: var(--row-bg);
            padding: 10px 5px;
            font-size: 0.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            word-break: break-word;
        }

        .cell-name {
            justify-content: flex-start;
            padding-left: 10px;
            font-weight: bold;
        }

        .cell-dpm {
            color: var(--dpm-color);
            font-weight: bold;
            font-size: 1rem;
        }

        .cell-category {
            font-size: 0.75rem;
            text-transform: uppercase;
            opacity: 0.8;
        }

        .cell-year {
            font-weight: bold;
            color: #8b949e;
        }

        .cell-boolean {
            font-size: 0.9rem;
            font-weight: bold;
        }

        .cell-boolean.yes {
            color: #238636;
        }

        .cell-boolean.no {
            color: #f85149;
        }

        .cell-boost {
            font-size: 0.8rem;
            font-weight: bold;
        }

        .cell-boost.boostable {
            color: #d4af37;
        }

        .cell-boost.not-boostable {
            color: #8b949e;
        }

        .cell-timer {
            font-family: monospace;
            font-size: 0.9em;
        }

        .cell-timer.active {
            color: #4caf50;
            font-weight: bold;
        }

        .cell-actions {
            display: flex;
            gap: 4px;
        }

        .stats {
            display: flex;
            flex-direction: column;
            font-size: 0.8em;
            line-height: 1.3;
        }

        .btn-log,
        .btn-reset {
            padding: 4px 8px;
            border: none;
            border-radius: 3px;
            cursor: pointer;
            font-size: 0.8em;
        }

        .btn-log {
            background-color: #4caf50;
            color: white;
        }

        .btn-reset {
            background-color: #f44336;
            color: white;
        }

        .btn-cd {
            background-color: #f44336;
            color: white;
        }

        .btn-sup {
            background-color: #d29922;
            color: black;
        }

        .btn-cd[disabled] {
            opacity: 0.9;
            cursor: not-allowed;
        }

        .btn-sup[disabled] {
            opacity: 0.7;
            cursor: not-allowed;
        }

        .btn-reset-stats {
            background-color: #30363d;
            color: #f85149;
            border: 1px solid #484f58;
            white-space: nowrap;
        }

        .btn-reset-stats:hover {
            background-color: #484f58;
        }

        .input-mini {
            width: 80px;
            padding: 4px;
            border: 1px solid #ccc;
            border-radius: 3px;
        }

        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--green-active);
            color: black;
            padding: 12px 20px;
            border-radius: 6px;
            font-weight: bold;
            display: none;
            z-index: 1000;
        }
    </style>
</head>

<body>

    <header>
        <h1>GTA Online Master Grinding Tracker</h1>
        <div style="color: #8b949e; margin-top: 5px;">Base de Datos y Cooldowns completamente editables en vivo.</div>
    </header>

    <div class="grid-container" id="grid-container">
        <div class="grid-header">Actividad</div>
        <div class="grid-header">Categor√≠a</div>
        <div class="grid-header">A√±o</div>
        <div class="grid-header">Solo</div>
        <div class="grid-header">Pasivo</div>
        <div class="grid-header">Boost</div>
        <div class="grid-header">Dinero</div>
        <div class="grid-header">Tiempo</div>
        <div class="grid-header">Start</div>
        <div class="grid-header">Stop</div>
        <div class="grid-header">CD</div>
        <div class="grid-header">SUP</div>

    </div>

    <div style="text-align: center; margin-top: 20px;">
        <button class="action-btn" onclick="requestAudio()">üîä Activar Notificaciones</button>
        <button class="action-btn" style="background: #30363d;" onclick="resetAllStats()">üßπ Borrar Stats</button>
        <button class="action-btn" style="background: #a30000; padding: 10px 20px;" onclick="resetAll()">üóëÔ∏è Borrar Todo
            (Stats, Timers)</button>
    </div>

    <div id="toast" class="toast"></div>

    <script>
        const STORAGE_SESSIONS = 'gta_master_sessions';
        const STORAGE_COOLDOWNS = 'gta_master_cooldowns';
        const STORAGE_COOLDOWNS_NOTIFIED = 'gta_master_cooldowns_notified';
        const STORAGE_RESUPPLY = 'gta_master_resupply';
        const STORAGE_RESUPPLY_NOTIFIED = 'gta_master_resupply_notified';
        const STORAGE_STATS = 'gta_master_stats';

        let timers = {};
        const audio = new Audio('https://actions.google.com/sounds/v1/alarms/beep_short.ogg');

        const UPDATED_DATA_2025 = [
            {
                id: 'contact-missions',
                variant: 'base',
                name: 'Misiones de Contacto',
                category: 'mission',
                release: 2013,
                boostable: false,
                modifiers: [],
                minCooldown: 0,
                avgTimeMin: 12,
                avgPayout: 30000,
                efficiency: 2500,
                payoutType: 'active',
                solo: true,
                passive: false
            },
            {
                id: 'vip-work',
                variant: 'base',
                name: 'VIP Work (CEO)',
                category: 'mission',
                release: 2015,
                boostable: false,
                modifiers: [],
                minCooldown: 5,
                avgTimeMin: 5,
                avgPayout: 25000,
                efficiency: 5000,
                payoutType: 'active',
                solo: true,
                passive: false
            },
            {
                id: 'fleeca-job',
                variant: 'base',
                name: 'The Fleeca Job',
                category: 'heist',
                release: 2015,
                boostable: false,
                modifiers: [],
                minCooldown: 0,
                avgTimeMin: 30,
                avgPayout: 150000,
                efficiency: 5000,
                payoutType: 'active',
                solo: false,
                passive: false
            },
            {
                id: 'pacific-standard',
                variant: 'base',
                name: 'Pacific Standard',
                category: 'heist',
                release: 2015,
                boostable: false,
                modifiers: [],
                minCooldown: 0,
                avgTimeMin: 45,
                avgPayout: 1200000,
                efficiency: 26666,
                payoutType: 'active',
                solo: false,
                passive: false
            },

            // === NEGOCIOS CEO (2016) ===
            {
                id: 'import-export',
                variant: 'base',
                name: 'Importaci√≥n / Exportaci√≥n',
                category: 'business',
                release: 2016,
                boostable: false,
                modifiers: [],
                minCooldown: 20,
                avgTimeMin: 15,
                avgPayout: 80000,
                efficiency: 5333,
                payoutType: 'active',
                solo: true,
                passive: false
            },
            {
                id: 'special-cargo',
                variant: 'base',
                name: 'Special Cargo (Cajas)',
                category: 'business',
                release: 2016,
                boostable: false,
                modifiers: [],
                minCooldown: 0,
                avgTimeMin: 10,
                avgPayout: 120000,
                efficiency: 12000,
                payoutType: 'active',
                solo: true,
                passive: false
            },
            {
                id: 'mc-coke',
                variant: 'base',
                name: 'MC Coca√≠na',
                category: 'passive-business',
                release: 2016,
                boostable: true,
                modifiers: [],
                minCooldown: 0,
                resupplyMin: 150,
                avgTimeMin: 0,
                avgPayout: 420000,
                efficiency: 0,
                payoutType: 'passive',
                solo: true,
                passive: true
            },

            // === NEGOCIOS PASIVOS (2017-2018) ===
            {
                id: 'bunker',
                variant: 'base',
                name: 'B√∫nker (Gunrunning)',
                category: 'passive-business',
                release: 2017,
                boostable: true,
                modifiers: [],
                minCooldown: 0,
                resupplyMin: 140,
                avgTimeMin: 0,
                avgPayout: 1050000,
                efficiency: 0,
                payoutType: 'passive',
                solo: true,
                passive: true
            },
            {
                id: 'nightclub',
                variant: 'base',
                name: 'Nightclub Warehouse',
                category: 'passive-business',
                release: 2018,
                boostable: true,
                modifiers: [],
                minCooldown: 0,
                avgTimeMin: 5,
                avgPayout: 1800000,
                efficiency: 360000,
                payoutType: 'passive',
                solo: true,
                passive: true
            },

            // === GOLPES MODERNOS (2019-2020) ===
            {
                id: 'casino-heist',
                variant: 'base',
                name: 'Golpe al Casino Diamond',
                category: 'heist',
                release: 2019,
                boostable: false,
                modifiers: [],
                minCooldown: 144,
                avgTimeMin: 90,
                avgPayout: 2300000,
                efficiency: 25555,
                payoutType: 'active',
                solo: false,
                passive: false
            },
            {
                id: 'cayo-perico',
                variant: 'base',
                name: 'Cayo Perico (Solo)',
                category: 'heist',
                release: 2020,
                boostable: true,
                modifiers: [],
                minCooldown: 144,
                avgTimeMin: 60,
                avgPayout: 1100000,
                efficiency: 18333,
                payoutType: 'active',
                solo: true,
                passive: false
            },

            // === CONTRATOS Y AGENCIAS (2021-2022) ===
            {
                id: 'auto-shop',
                variant: 'base',
                name: 'Auto Shop Contracts',
                category: 'contract',
                release: 2021,
                boostable: false,
                modifiers: [],
                minCooldown: 0,
                avgTimeMin: 30,
                avgPayout: 170000,
                efficiency: 5666,
                payoutType: 'active',
                solo: true,
                passive: false
            },
            {
                id: 'agency-dre',
                variant: 'base',
                name: 'Agencia: Contrato Dr. Dre',
                category: 'contract',
                release: 2021,
                boostable: true,
                modifiers: [],
                minCooldown: 48,
                avgTimeMin: 95,
                avgPayout: 1000000,
                efficiency: 10526,
                payoutType: 'active',
                solo: true,
                passive: false
            },
            {
                id: 'payphone-hit',
                variant: 'base',
                name: 'Payphone Hit',
                category: 'mission',
                release: 2021,
                boostable: false,
                modifiers: [],
                minCooldown: 10,
                avgTimeMin: 5,
                avgPayout: 85000,
                efficiency: 17000,
                payoutType: 'active',
                solo: true,
                passive: false
            },
            {
                id: 'acid-lab',
                variant: 'base',
                name: 'Acid Lab',
                category: 'passive-business',
                release: 2022,
                boostable: true,
                modifiers: [],
                minCooldown: 0,
                resupplyMin: 180,
                avgTimeMin: 0,
                avgPayout: 335000,
                efficiency: 0,
                payoutType: 'passive',
                solo: true,
                passive: true
            },

            // === ACTUALIZACIONES RECIENTES (2023-2024) ===
            {
                id: 'salvage-yard',
                variant: 'base',
                name: 'Robos de Desguace',
                category: 'robbery',
                release: 2023,
                boostable: false,
                modifiers: [],
                minCooldown: 10080,
                avgTimeMin: 60,
                avgPayout: 800000,
                efficiency: 13333,
                payoutType: 'active',
                solo: true,
                passive: false
            },
            {
                id: 'cluckin-bell',
                variant: 'base',
                name: 'Cluckin Bell Farm Raid',
                category: 'mini-heist',
                release: 2024,
                boostable: false,
                modifiers: [],
                minCooldown: 60,
                avgTimeMin: 45,
                avgPayout: 500000,
                efficiency: 11111,
                payoutType: 'active',
                solo: true,
                passive: false
            },
            {
                id: 'bounties',
                variant: 'base',
                name: 'Bottom Dollar Bounties',
                category: 'mission',
                release: 2024,
                boostable: false,
                modifiers: [],
                minCooldown: 0,
                avgTimeMin: 10,
                avgPayout: 40000,
                efficiency: 4000,
                payoutType: 'active',
                solo: true,
                passive: false
            },
            {
                id: 'agents-sabotage',
                variant: 'base',
                name: 'Sabotage Operations (Darnell Bros)',
                category: 'covert-ops',
                release: 2024,
                boostable: false,
                modifiers: ['pavel', 'fib-tech'],
                minCooldown: 48,
                avgTimeMin: 40,
                avgPayout: 650000,
                efficiency: 16250,
                payoutType: 'active',
                solo: true,
                passive: false
            },

            // === FUTURO (2025) ===
            {
                id: 'money-fronts',
                variant: 'base',
                name: 'Money Fronts (Lavado de Dinero)',
                category: 'passive-business',
                release: 2025,
                boostable: true,
                modifiers: ['laundering-bonus'],
                minCooldown: 0,
                resupplyMin: 0,
                avgTimeMin: 0,
                avgPayout: 300000,
                efficiency: 0,
                payoutType: 'passive',
                solo: true,
                passive: true
            },
            {
                id: 'mansions',
                variant: 'base',
                name: 'Mansion Contracts (Michael De Santa)',
                category: 'contract',
                release: 2025,
                boostable: false,
                modifiers: ['movie-magic'],
                minCooldown: 30,
                avgTimeMin: 25,
                avgPayout: 400000,
                efficiency: 16000,
                payoutType: 'active',
                solo: true,
                passive: false
            }
        ];
        let CURRENT_DATA = [];

        function loadBaseData() {
            const storedData = localStorage.getItem(STORAGE_DATA);
            CURRENT_DATA = storedData ? JSON.parse(storedData) : JSON.parse(JSON.stringify(UPDATED_DATA_2025));

            // Convert new field names to legacy format for compatibility
            CURRENT_DATA = CURRENT_DATA.map(item => ({
                ...item,
                min: item.minCooldown || 0,
                info: `${item.category} - ${item.release} - ${item.avgPayout ? `$${formatMoney(item.avgPayout)}` : ''} - ${item.efficiency ? `${item.efficiency}$/min` : ''}`
            }));
        }

        function init() {
            loadBaseData();
            renderGrid();
            setInterval(updateTimers, 1000);
            updateTimers();
        }

        function renderGrid() {
            const container = document.getElementById('grid-container');
            if (!container) return;

            const dataWithStats = CURRENT_DATA.map(activity => {
                const stats = getStats(activity.id);
                const dpm = calculateDPM(stats.totalMoney || 0, stats.totalTime || 0);
                return { ...activity, stats, dpm };
            });

            dataWithStats.sort((a, b) => (b.dpm || 0) - (a.dpm || 0));

            let html = `
        <div class="grid-header">Actividad</div>
        <div class="grid-header">Dinero</div>
        <div class="grid-header">Tiempo</div>
        <div class="grid-header">Start</div>
        <div class="grid-header">Stop</div>
        <div class="grid-header">CD</div>
        <div class="grid-header">SUP</div>
        <div class="grid-header">Reset</div>
        <div class="grid-header">Stats</div>
    `;

            dataWithStats.forEach(activity => {
                const stats = activity.stats;
                const hasCooldown = (activity.min || 0) > 0;
                const hasResupply = (activity.resupplyMin || 0) > 0;
                html += `
            <div class="grid-cell cell-name">${activity.name}</div>
            <div class="grid-cell">
                <input type="number" id="money-${activity.id}" class="input-mini" placeholder="$">
            </div>
            <div class="grid-cell cell-timer" id="t-${activity.id}">00:00:00</div>
            <div class="grid-cell"><button class="btn-log" onclick="startSession('${activity.id}')">Start</button></div>
            <div class="grid-cell"><button class="btn-reset" onclick="stopSession('${activity.id}')">Stop</button></div>
            <div class="grid-cell"><button class="btn-cd" id="cd-btn-${activity.id}" onclick="startCooldown('${activity.id}')" ${hasCooldown ? '' : 'disabled'}>Empezar CD</button></div>
            <div class="grid-cell"><button class="btn-sup" id="sup-btn-${activity.id}" onclick="startResupply('${activity.id}')" ${hasResupply ? '' : 'disabled'}>Reponer</button></div>
            <div class="grid-cell"><button class="btn-reset-stats" onclick="resetStats('${activity.id}')">Reset</button></div>
            <div class="grid-cell">
                <div class="stats">
                    <span>$${formatMoney(stats.totalMoney || 0)}</span>
                    <span>${(stats.totalTime || 0).toFixed ? (stats.totalTime || 0).toFixed(1) : (stats.totalTime || 0)}m</span>
                    <span>$${calculateDPM(stats.totalMoney || 0, stats.totalTime || 0).toFixed(2)}/min</span>
                </div>
            </div>
        `;
            });

            container.innerHTML = html;
            updateTimers();
        }

        function calculateDPM(money, time) {
            return time > 0 ? (money / time) : 0;
        }

        function getStats(id) {
            const stats = JSON.parse(localStorage.getItem(STORAGE_STATS) || '{}');
            return stats[id] || { totalMoney: 0, totalTime: 0, count: 0, dpm: 0.00 };
        }

        function getSessions() {
            return JSON.parse(localStorage.getItem(STORAGE_SESSIONS) || '{}');
        }

        function setSessions(sessions) {
            localStorage.setItem(STORAGE_SESSIONS, JSON.stringify(sessions));
        }

        function getCooldowns() {
            return JSON.parse(localStorage.getItem(STORAGE_COOLDOWNS) || '{}');
        }

        function setCooldowns(cooldowns) {
            localStorage.setItem(STORAGE_COOLDOWNS, JSON.stringify(cooldowns));
        }

        function getCooldownNotified() {
            return JSON.parse(localStorage.getItem(STORAGE_COOLDOWNS_NOTIFIED) || '{}');
        }

        function setCooldownNotified(notified) {
            localStorage.setItem(STORAGE_COOLDOWNS_NOTIFIED, JSON.stringify(notified));
        }

        function getResupply() {
            return JSON.parse(localStorage.getItem(STORAGE_RESUPPLY) || '{}');
        }

        function setResupply(resupply) {
            localStorage.setItem(STORAGE_RESUPPLY, JSON.stringify(resupply));
        }

        function getResupplyNotified() {
            return JSON.parse(localStorage.getItem(STORAGE_RESUPPLY_NOTIFIED) || '{}');
        }

        function setResupplyNotified(notified) {
            localStorage.setItem(STORAGE_RESUPPLY_NOTIFIED, JSON.stringify(notified));
        }

        function startSession(id) {
            const sessions = getSessions();
            if (sessions[id] && sessions[id].startTime) {
                notify('Ya hay una sesi√≥n activa para esta actividad.', true);
                return;
            }

            sessions[id] = { startTime: Date.now() };
            setSessions(sessions);
            updateTimers();
        }

        function stopSession(id) {
            const sessions = getSessions();
            const session = sessions[id];
            if (!session || !session.startTime) {
                notify('No hay una sesi√≥n activa para parar.', true);
                return;
            }

            const moneyInput = document.getElementById(`money-${id}`);
            const money = parseFloat(moneyInput?.value || '0') || 0;
            if (money <= 0) {
                notify('Introduce el dinero ganado antes de parar.', true);
                return;
            }

            const elapsedMs = Date.now() - session.startTime;
            const elapsedMinutes = elapsedMs / 60000;

            const stats = JSON.parse(localStorage.getItem(STORAGE_STATS) || '{}');
            const itemStats = stats[id] || { totalMoney: 0, totalTime: 0, count: 0, dpm: 0.00 };
            itemStats.totalMoney += money;
            itemStats.totalTime += elapsedMinutes;
            itemStats.count += 1;
            itemStats.dpm = calculateDPM(itemStats.totalMoney, itemStats.totalTime);
            stats[id] = itemStats;
            localStorage.setItem(STORAGE_STATS, JSON.stringify(stats));

            delete sessions[id];
            setSessions(sessions);

            if (moneyInput) moneyInput.value = '';

            renderGrid();
            notify(`Guardado: $${formatMoney(Math.round(money))} en ${(elapsedMinutes).toFixed(1)} min.`, true);
        }

        function startCooldown(id) {
            const item = CURRENT_DATA.find(d => d.id === id);
            if (!item) return;

            const minutes = item.min || 0;
            if (minutes <= 0) {
                notify('Esta actividad no tiene cooldown configurado.', true);
                return;
            }

            const cooldowns = getCooldowns();
            const notified = getCooldownNotified();
            const now = Date.now();

            const currentEndTime = cooldowns[id];

            if (currentEndTime && currentEndTime > now) {
                delete cooldowns[id];
                setCooldowns(cooldowns);
                delete notified[id];
                setCooldownNotified(notified);
                updateTimers();
                return;
            }

            const endTime = now + (minutes * 60000);
            cooldowns[id] = endTime;
            setCooldowns(cooldowns);
            delete notified[id];
            setCooldownNotified(notified);

            updateTimers();
        }

        function startResupply(id) {
            const item = CURRENT_DATA.find(d => d.id === id);
            if (!item) return;

            const minutes = item.resupplyMin || 0;
            if (minutes <= 0) {
                notify('Esta actividad no tiene aviso de reponer configurado.', true);
                return;
            }

            const resupply = getResupply();
            const notified = getResupplyNotified();
            const now = Date.now();

            const currentEndTime = resupply[id];
            if (currentEndTime && currentEndTime > now) {
                delete resupply[id];
                setResupply(resupply);
                delete notified[id];
                setResupplyNotified(notified);
                updateTimers();
                return;
            }

            const endTime = now + (minutes * 60000);
            resupply[id] = endTime;
            setResupply(resupply);
            delete notified[id];
            setResupplyNotified(notified);
            updateTimers();
        }

        function resetStats(id) {
            if (confirm('¬øSeguro que quieres borrar las estad√≠sticas de esta actividad?')) {
                let stats = JSON.parse(localStorage.getItem(STORAGE_STATS) || '{}');
                delete stats[id];
                localStorage.setItem(STORAGE_STATS, JSON.stringify(stats));
                notify(`Estad√≠sticas de ${CURRENT_DATA.find(d => d.id === id).name} borradas.`, true);
                renderGrid();
            }
        }

        function resetAllStats() {
            if (confirm('¬øSeguro que quieres borrar TODAS las estad√≠sticas?')) {
                localStorage.removeItem(STORAGE_STATS);
                renderGrid();
                notify('Estad√≠sticas borradas.', true);
            }
        }

        function updateTimers() {
            const now = Date.now();
            const sessions = getSessions();
            const cooldowns = getCooldowns();
            const notified = getCooldownNotified();
            const resupply = getResupply();
            const resupplyNotified = getResupplyNotified();

            CURRENT_DATA.forEach(item => {
                const timerEl = document.getElementById(`t-${item.id}`);
                if (!timerEl) return;

                const session = sessions[item.id];
                if (session && session.startTime) {
                    timerEl.textContent = formatElapsedTime(now - session.startTime);
                    timerEl.className = 'grid-cell cell-timer active';
                } else {
                    timerEl.textContent = '00:00:00';
                    timerEl.className = 'grid-cell cell-timer';
                }

                const cdBtn = document.getElementById(`cd-btn-${item.id}`);
                if (!cdBtn) return;

                const endTime = cooldowns[item.id];
                if (endTime && endTime > now) {
                    cdBtn.textContent = formatTimeLeft(endTime - now);
                } else if (endTime && endTime <= now) {
                    cdBtn.textContent = 'Empezar CD';

                    if (!notified[item.id] || notified[item.id] !== endTime) {
                        notify(`${item.name} (Cooldown listo)`);
                        notified[item.id] = endTime;
                        setCooldownNotified(notified);
                    }
                } else {
                    cdBtn.textContent = 'Empezar CD';
                }

                cdBtn.disabled = (item.min || 0) <= 0;

                const supBtn = document.getElementById(`sup-btn-${item.id}`);
                if (!supBtn) return;

                const supEndTime = resupply[item.id];
                if (supEndTime && supEndTime > now) {
                    supBtn.textContent = formatTimeLeft(supEndTime - now);
                } else if (supEndTime && supEndTime <= now) {
                    supBtn.textContent = 'Reponer';

                    if (!resupplyNotified[item.id] || resupplyNotified[item.id] !== supEndTime) {
                        notify(`${item.name} (Reponer suministros)`);
                        resupplyNotified[item.id] = supEndTime;
                        setResupplyNotified(resupplyNotified);
                    }
                } else {
                    supBtn.textContent = 'Reponer';
                }

                supBtn.disabled = (item.resupplyMin || 0) <= 0;
            });
        }

        function formatTimeLeft(ms) {
            const totalSeconds = Math.max(0, Math.floor(ms / 1000));
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;

            return [
                hours.toString().padStart(2, '0'),
                minutes.toString().padStart(2, '0'),
                seconds.toString().padStart(2, '0')
            ].join(':');
        }

        function formatElapsedTime(ms) {
            const totalSeconds = Math.max(0, Math.floor(ms / 1000));
            const hours = Math.floor(totalSeconds / 3600);
            const minutes = Math.floor((totalSeconds % 3600) / 60);
            const seconds = totalSeconds % 60;

            return [
                hours.toString().padStart(2, '0'),
                minutes.toString().padStart(2, '0'),
                seconds.toString().padStart(2, '0')
            ].join(':');
        }

        function formatMoney(amount) {
            return amount.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
        }

        function notify(name, isLog = false) {
            const toast = document.getElementById('toast');
            toast.innerText = isLog ? name : `‚úÖ ${name} ya est√° disponible`;
            toast.style.background = isLog ? '#58a6ff' : 'var(--green-active)';
            toast.style.color = 'black';
            toast.style.display = 'block';
            audio.play().catch(() => { });

            if (Notification.permission === "granted" && !isLog) {
                new Notification("GTA Online Tracker", { body: `${name} completado o listo.` });
            }

            setTimeout(() => { toast.style.display = 'none'; }, 5000);
        }

        function requestAudio() {
            if (Notification.permission !== "granted") {
                Notification.requestPermission();
            }
            audio.play().then(() => {
                audio.pause();
                audio.currentTime = 0;
                alert("Notificaciones y Audio activados.");
            }).catch(() => {
                alert("Haga clic en la p√°gina una vez para desbloquear el audio.");
            });
        }

        function resetAll() {
            if (confirm("ADVERTENCIA: Esto borrar√° TODA la data (Stats, Timers).")) {
                localStorage.clear();
                init();
            }
        }

        init();
    </script>
</body>

</html>